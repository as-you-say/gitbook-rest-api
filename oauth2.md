# OAuth2 인증방법\(진행중\)

### 4. OAuth2 인증 사용방법

모든 요청이 쿠키와 함께 가기 때문에, Server 측에서 Client 로 전달하는 쿠키를 읽을 수 없고, 수정할 수 없도록 옵션을 준 다음, 웹 브라우저에 리턴합니다.

따라서 모든 요청을 할 때마다 쿠키에 있는 토큰을 읽어들여서 해당하는 인증정보를 가지고 있는지 검증합니다. 쿠키가 가지고 있는 인증 정보는 사용자의 아이디와 이름을 포함하는 기타 정보들이 있습니다.

JWT 를 이용하여 토큰이 보유하고 있는 사용자 정보와 웹서버의 세션이 가지고 있는 사용자 정보의 일치여부를 확인하여 요정의 권한을 검증하게 됩니다.

초기에 오픈 API 프로세스는 아래와 같습니다.

{% hint style="info" %}
**웹서비스 OPEN API - 웹서비스와 사업자와 사용자 사이의 프로세스**  
1. 오픈 API를 제공하는 웹서비스의 홈페이지에서 사업자 아이디로 회원가입  
  
2. 해당하는 아이피만 허용하도록 API 이용자 정보를 등록 \(트래픽 당 요금이 발생하는 경우가 많기에 필수\)  
  
3. 등록이 완료되면 바로 제공되는 클라이언트 키 / 시크릿 키 값을 별도로 저장  
  
4. 프로젝트의 보안상 안전한 폴더에 키 파일을 보관 후 읽어와서 이용할 수 있도록 함 \(properties/yml\)  
  
5. 클라이언트 키와 시크릿 키를 이용하여 접속한 사용자에게 사용자가 가입되어있는 웹서비스의 개인정보에 대한 접근권한을 허용해달라는 팝업창을 띄우는 코드를 작성  
  
6. 사용자가 사업자의 프로젝트에 로그인 후, 사용자가 이용하고있는 웹 서비스의 정보를 사업자의 프로젝트에서 접근할 수 있도록, 동의를 구하는 링크또는 팝업으로 이동  
  
7. 권한 허용 버튼을 클릭  
  
8. 사업자의 프로젝트서버는 사용자의 정보에 대해 접근할 수 있는 엑세스 토큰과 리프레시 토큰을 발급받음  
  
9. 엑세스 토큰과, 리프레시 토큰을 사업자 프로젝트의 데이터베이스에 보관  
\(이 때, 리프레시 토큰이 있는 경우에는 엑세스 토큰의 만료기간이 있는 경우입니다. 따라서 리프레시 토큰이 없을 수도 있습니다. - 정책에 따라서 달리 사용됨.\)  
  
10. 사용자는 사업자 프로젝트를 이용할 때마다 본인이 허용했던 다른 웹 서비스의 정보를 함께 이용할 수 있음  
  
**!!!!!! 중요  
웹서비스 - OPEN API 제공  
통합 포탈 사이트\(SSO\) - 다양한 웹 서비스의 데이터를 가지고 화면을 보여줌  
사용자 - 기존에 여러개의 웹 서비스를 이용하고 있지만, 통합 포탈 사이트가 내가 필요로하는 웹 서비스들을 동시에 관리해주고, 원하는 모습으로 보여주고 있기 때문에 마음에 들어서 통합 포탈 사이트에 가입 후, 내가 사용하는 웹 서비스의 권한을 허용해서 한번에 보면서 관리하고 싶은 사람**
{% endhint %}



### 5. OPEN API 등록 후 사용방법

포탈 사이트 회원가입  
포탈 사이트 로그인  
웹서비스 허용권한 요청팝업  
웹서비스 허용권한 승인  
포탈 사이트 백엔드에서 웹 서비스에서 발급받은 토큰을 가져와서 디비에 저장  
\(이 방법은, 허용 권한 승인 후, 엑세스토큰을 https://포탈사이트.co.kr/callback?token=XXXX형식으로 리다이렉트 하면, 이 데이터만 쏙 빼서 디비에 저장 후에 바로 메인화면으로 이동해버린다. 오키?\)   
이제 포탈사이트 로그인 시에 디비에 있는 토큰을 가지고 요청을 전송

